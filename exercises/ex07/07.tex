\documentclass{exam}
\usepackage{amsmath, amsfonts}
\usepackage{bm}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage[super]{nth}
\usepackage{booktabs}

\DeclareMathOperator*{\argmin}{argmin}

\usepackage[hyperfootnotes=false]{hyperref}

\usepackage[usenames,dvipsnames]{color}
\newcommand{\note}[1]{
	\noindent~\\
	\vspace{0.25cm}
	\fcolorbox{Red}{Orange}{\parbox{0.99\textwidth}{#1\\}}
	%{\parbox{0.99\textwidth}{#1\\}}
	\vspace{0.25cm}
}


\input{../macros.tex}
%\renewcommand{\hide}[1]{#1}

\qformat{\thequestion. \textbf{\thequestiontitle}\hfill[\thepoints]}
\bonusqformat{\thequestion. \textbf{\thequestiontitle}\hfill[\thepoints]}

\pagestyle{headandfoot}

%%%%%% MODIFY FOR EACH SHEET!!!! %%%%%%
\newcommand{\duedate}{07.06.19 (10:00)}
\newcommand{\due}{{\bf This assignment is due on \duedate.} }
\firstpageheader
{Due: \duedate \\ Points: 6}
{{\bf\lecture}\\ \assignment{6}}
{\lectors\\ \semester}

\runningheader
{Due: \duedate}
{\assignment{6}}
{\semester}
%%%%%% MODIFY FOR EACH SHEET!!!! %%%%%%

\firstpagefooter
{}
{\thepage}
{}

\runningfooter
{}
{\thepage}
{}

\headrule
\pointsinrightmargin
\bracketedpoints
\marginpointname{pt.}




\newcommand{\parents}{p}
\newcommand{\negation}[1]{\overline{#1}}
%\newcommand{\tuple}[1]{\langle #1 \rangle}
\newcommand{\tuple}[1]{\left<#1\right>}
\newcommand{\dom}[1]{dom(#1)}              % domain

\newcommand{\false}{false}
\newcommand{\true}{true}
\newcommand{\TRUE}{{\mbox{\scriptsize \em TRUE}}}
\newcommand{\FALSE}{{\mbox{\scriptsize \em FALSE}}}

\newcommand{\bSigma}{\bm{\Sigma}}
\newcommand{\bmu}{\bm{\mu}}
\newcommand{\bx}{\bm{x}}
\newcommand{\by}{\bm{y}}
\newcommand{\bX}{\bm{X}}
\newcommand{\bI}{\bm{I}}
\newcommand{\bw}{\bm{w}}
\newcommand{\ba}{\bm{a}}
\newcommand{\bb}{\bm{b}}
\newcommand{\bk}{\bm{k}}  
\newcommand{\inv}{^{-1}}

\newcommand{\norm}{{\mathcal{N}}}

\newcommand\transpose{^{\textrm{\tiny{\sf{T}}}}}

\begin{document}
	\gccs
	Now that you have learned about the theory behind GPs, you will have to use that theory to implement GPs yourself.
	\begin{questions}
		\titledquestion{Differentiable Architecture Search}[5]
		In this second part of the exercise you will run DARTS for finding an optimal CNN architecture on MNIST.
		The search model is defined in \texttt{model\_search.py}. It contains three stacked cells: 
		reduction-normal-reduction. The architecture search problem is to find an optimal operation out of
		$\mathcal{O} = \{conv\_3x3,\\ max\_pool\_3x3, avg\_pool\_3x3, Identity\}$ in each edge
		of these cells. The number of intermediate nodes is 2. 
		
		\begin{parts}
		\part[3] In order to create the architecture continuous relaxation,
		we need to define a \textit{MixedOp}, which is a convex combination of the operations outputs connecting two nodes
		in the cells. It is defined as follows: $$x^{(j)} = \sum_{i<j}\tilde{o}^{(i,j)}(x^{(i)}) = \sum_{i<j}\sum_{o\in\mathcal{O}}\frac{e^{\alpha_{o}^{(i,j)}}}{\sum_{o^{\prime}\in\mathcal{O}}e^{\alpha_{o^{\prime}}^{(i,j)}}}o(x^{(i)})$$

		Based on this formulation you have to fill in the code in lines 46-57 of \texttt{model\_search.py} in order to 
		compute the output tensor $x^{(j)}$ of the MixedOp.

		\part[2] Having defined the search model, we now need to run the DARTS optimization loop (Algorithmi 1, Slide 31 of Lecture 7). We will use the first-order approximation. Your task is going to be only to write the lines of code that compute the architectural updates in lines 43-49 of \texttt{train\_search.py}. Afterwards, you should be able to run \texttt{python train\_search.py} without any errors. This will conduct the search for 5 epochs and write in a directory named \texttt{logs/} the output logs and a file with the optimal architecture configuration.\\

		In the end, to generate a visualization of the found cells run \texttt{python visualize.py}. This should generate two \texttt{.pdf} files named \texttt{normal.pdf} and \texttt{reduction.pdf}.
		Push the contents written in \texttt{logs/} together with the two \texttt{.pdf} files generated by the visualization script to your Bitbucket repository.\\

		\textbf{NOTE}: Running \texttt{train\_search.py} on a GPU machine takes a few minutes. This might scale to more than 1h when running on a CPU machine.

		\end{parts}

		\titledquestion{Feedback}[Bonus: 0.5]
		For each question in this assignment, state:
		\begin{itemize}
			\item How long you worked on it.
			\item What you learned.
			\item Anything you would improve in this question if you were teaching the course.
		\end{itemize}
	\end{questions}
	
	\noindent
	\due Submit your solution for the tasks by uploading a PDF to your groups BitBucket repository. The PDF has to include the name of the submitter(s).
\end{document}
