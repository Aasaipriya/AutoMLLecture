\input{../latex_main/main.tex}

\newcommand{\a}[0]{\mathbf{a}}
\newcommand{\cost}[0]{\mathbf{y}}
\newcommand{\q}[0]{\mathbf{q}}

\title[AutoML: Overview]{Multi-criteria Optimization}
\subtitle{Introduction}
\author[Bernd Bischl]{\underline{Bernd Bischl} \and Frank Hutter \and Lars Kotthoff \and Marius Lindauer}
\institute{}
\date{}



% \AtBeginSection[] % Do nothing for \section*
% {
%   \begin{frame}{Outline}
%     \bigskip
%     \vfill
%     \tableofcontents[currentsection]
%   \end{frame}
% }

\begin{document}

	\maketitle


\begin{frame}{Notation}

\begin{itemize}
\item Admissible set $\conf \subset \pcs$
\item Target region $\realnum^m$
\item Multi-criteria objective function $\cost: \pcs \to \realnum^m$
\item Objective function vector $\cost(\conf) = \left(\cost(\conf)_1, ..., \cost(\conf)_m^\top \in \realnum^m$, which maps $\conf$ into the space $\realnum^m$.
% \item $F:=f(\pcs) = \left\{f(\conf) ~|~ \conf \in \pcs\right\}$: Bild einer Funktion (Menge aller möglichen Funktionswerte)
\end{itemize}

w.l.o.g. we look at minimization problems.

\end{frame}

\begin{frame}[allowframebreaks]{Introductory Example}

Often we want to solve optimization problems concerning several goals.

General applications:
\begin{itemize}
\item Medicine: maximum effect, but minimum side effect of a drug.
\item Finances: maximum return, but minimum risk of an equity portfolio.
\item Production planning: maximum revenue, but minimum costs.
\item Booking a hotel: maximum rating, but minimum costs.
\end{itemize}

In machine learning:
\begin{itemize}
\item Sparse models: maximum predictive performance, but minimal number of features.
\item Fast models: maximum predictive performance, but short inference time.
\item ...
\end{itemize}

A \textit{simple} approach would be to formulate all but one objective function simplified as a secondary condition.

\vspace*{0.2cm}

\framebreak

\textbf{Example}:

Maximize hotel rating subject to a maximum price per night.

\vspace*{0.2cm}

 \textbf{Disadvantages}:
\begin{itemize}
 \item The result depends of course on how we select the max price and usually returns different solutions for different max price values.
 \item The more target functions we optimize, the more difficult such a definition becomes.
\end{itemize}

\vspace*{0.2cm}

\textbf{Goal}: find a general approach to solving multi-criteria problems.


\begin{center}
\includegraphics[width = 0.35\linewidth]{images/booking1.png} ~~~ \includegraphics[width = 0.35\linewidth]{images/booking2.png}
\end{center}

When booking a hotel: find the hotel with

\begin{itemize}
\item Minimum price per night (\textbf{costs}) and
\item Maximum user rating (\textbf{performance}).
\end{itemize}

\vfill

\begin{footnotesize}
Since we limit ourselves to minimizing problems, we minimize negative valuations.
\end{footnotesize}

\framebreak

The goals often conflict with each other:

\begin{itemize}
\item Lower price $\to$ often lower hotel rating.
\item Better rating $\to$ usually higher price.
\end{itemize}

Example: (negative) average rating by hotel guests (1 - 5) vs. average price per night in USD from hotels on Expedia (excerpt).

\vspace*{0.2cm}

\centering \includegraphics[scale=1]{images/expedia-1-1}


\framebreak

In addition, targets are often not comparable because they have different units, for example:

\begin{itemize}
    \item Left: a hotel with rating $4$ for $89$ Euro ($\textcolor{green}{\cost^{(1)}} = \left(89, - 4.0\right)$ would be preferred to a hotel $\textcolor{red}{\cost^{(2)}} = \left(108, - 4.0\right)$)
\item Right: how to decide if $\textcolor{orange}{\cost^{(1)}} = \left(89, - 4.0\right)$ and $\textcolor{orange}{\cost^{(1)}} = \left(95, - 4.5\right)$?
\item How much money is one \textit{rating point} worth?
\end{itemize}

\centering \includegraphics[scale=1]{images/expedia-2-1}

\end{frame}


\begin{frame}{Definition: multi-criteria optimization problem}

Let $\pcs \subset \realnum^n$ and $\cost: \pcs \to \realnum^m$, $m \ge 2$. A \textbf{multi-criteria optimization problem} is defined by

$$
\min_{\conf \in \pcs}  \cost(\conf) \Leftrightarrow \min_{\conf \in \pcs} \left(\cost_1(\conf), \cost_2(\conf), ..., \cost_m(\conf)\right).
$$

\begin{itemize}
\item \textbf{Goal:} minimize multiple target functions simultaneously.
\item Objective functions are often conflicting.
\item Often no clear best solution, but a set of solutions that are equally good.
\item Synonym terms: multi-criteria optimization, multi-objective optimization, Pareto optimization
\end{itemize}

\end{frame}

\begin{frame}{Pareto sets und Pareto optimality}

\textbf{Definition:}

Given a multicriteria optimization problem
    $$\min_{\conf \in \pcs} \cost(\conf) = \left(\cost_1(\conf), ..., \cost_m(\conf)\right), \quad \cost_i: \pcs \to \realnum.$$

\begin{itemize}
    \item A solution $\conf^{(1)}$ \textbf{(Pareto-) dominates} $\conf^{(2)}$, if $\cost(\conf^{(1)}) \prec \cost(\conf^{(2)})$, i.e.
\begin{enumerate}
    \item $\cost_i(\conf^{(1)}) \le \cost_i(\conf^{(2)})$ for all $i \in \{1, 2, ..., m\}$ and
    \item $\cost_j(\conf^{(1)}) < \cost_j(\conf^{(2)})$ for at least one $j \in \{1, 2, ..., m\}$
\end{enumerate}
\vspace*{0.1cm}
\item A solution $\optconf$ that is not dominated by any other solution is called \textbf{Pareto optimal}.
\vspace*{0.1cm}
\item The set of all Pareto optimal solutions is called \textbf{Pareto set} $\mathcal{P} := \{\conf \in \pcs |\not \exists ~\tilde{\conf} \text{ with } \cost(\tilde{\conf}) \prec \cost(\conf)\}$
\item $\mathcal{F} = \cost(\mathcal{P}) = \{\cost(\conf) | \conf \in \mathcal{P}\}$ is called \textbf{Pareto front}.
\end{itemize}

\end{frame}


\begin{frame}[allowframebreaks]{How to define optimality?}

Let still $\cost = (\text{price}, - \text{rating})$. For some cases it is \textit{clear} which point is the better one:

\begin{itemize}
    \item The solution $\textcolor{green}{\cost^{(1)}} = \left(89, - 4.0\right)$ dominates $\textcolor{red}{\cost^{(2)}} = \left(108, - 4.0\right)$: $\textcolor{green}{\cost^{(1)}}$ is not worse in any dimension and is better in one dimension. $\textcolor{red}{\cost^{(2)}}$ gets \textbf{dominated} by $\textcolor{green}{\cost^{(1)}}$
$$
\textcolor{red}{\cost^{(2)}} \prec \textcolor{green}{\cost^{(1)}}.
$$
\end{itemize}

\centering \includegraphics[width=0.5\linewidth]{images/expedia-3-1}

\framebreak

For the points $\textcolor{orange}{\cost^{(1)}} = \left(89, - 4.0\right)$ and $\textcolor{orange}{\cost^{(2)}} = \left(95, - 4.5\right)$ we cannot say which one is better.

\begin{itemize}
\item We define the points as \textbf{equivalent} and write

$$
\textcolor{orange}{\cost^{(1)}} \not\prec \textcolor{orange}{\cost^{(2)}} \text{ and } \textcolor{orange}{\cost^{(2)}} \not\prec \textcolor{orange}{\cost^{(1)}}.
$$

\centering \includegraphics[width=0.5\linewidth]{images/expedia-4-1}


\item The set of all equivalent points that are not dominated by another point is called the \textbf{Pareto front}.

\vspace*{0.3cm}

\centering \includegraphics[width=0.8\linewidth]{images/expedia-5-1}



\end{itemize}

\end{frame}

\begin{frame}{Example: An Objective Function}


We consider the minimization problem

$$
\min_{\conf} \cost(\conf) = (\conf - 1)^2, \qquad 0 \le \conf \le 3.
$$

The optimum is at $\optconf = 1$.

\vspace*{0.1cm}


\centering \includegraphics[scale=0.2]{images/graph1}


\end{frame}

\begin{frame}[allowframebreaks]{Example: two target functions}

We extend the above problem to two objective functions $\cost_1(\conf) = (\conf - 1)^2$ and $\cost_2(\conf) = 3(\conf - 2)^2$, thus

$$
    \min_{\conf} \cost(\conf) := \left(\cost_1(\conf), \cost_2(\conf)\right), \qquad 0 \le \conf \le 3.
$$

    \begin{center}
    \includegraphics[scale=0.2]{images/graph2}
    \end{center}

\framebreak

We consider the functions in the objective function space $\cost(\pcs)$ by drawing the objective function values $\left(\cost_1(\conf), \cost_2(\conf)\right)$ for all $0 \le \conf \le 3$.

\vspace*{0.1cm}


    \begin{center}
    \includegraphics[scale=0.2]{images/graph3}
    \end{center}
    \vspace*{-0.3cm}

The Pareto front is shown in green.
The Pareto front cannot be \enquote{left} without getting worse in at least one objective function.

\end{frame}


\begin{frame}{Two solutions}

\begin{itemize}
\item The Pareto set is a set of equally optimal solutions.
\item In many applications one is often interested in a \textbf{single} optimal solution.
\item Without further information no unambiguous optimal solution can be determined \\
$\to$ decision must be based on other criteria.
\end{itemize}

There are two possible approaches:
\begin{itemize}
\item \textbf{A-priori approach}: user preferences are considered \textbf{before} the optimization process
\item \textbf{A-posteriori approach}: user preferences are considered \textbf{after} the optimization process
\end{itemize}

\end{frame}

\begin{frame}[allowframebreaks]{A-priori procedure}

\textbf{Example: weighted total}


\textbf{Prior knowledge:} one rating point is worth $50$ Euro to a customer. \\ $\to$ We optimize the weighted sum:

$$
\min_\text{Hotel} \text{(Price / Night)} - 50 \cdot \text{Rating}
$$

    \begin{center}
\includegraphics[scale=0.555555]{images/expedia-9-1}
    \end{center}

    Alternative weighted sum: $\min_{\conf \in \pcs} \sum_{i = 1}^m w_i \cost_i(\conf) \qquad \text{with} \quad w_i \ge 0 $
% Bei systematischem Variieren der Gewichte können alle Lösungen auf dem konvexen Zielbereich gefunden werden.

\framebreak

\textbf{Example: Lexicographic method}

\lz

\textbf{Prior knowledge:} customer prioritizes rating over price. \\
$\to$ optimize target functions one after the other.

\lz

    \begin{center}
\includegraphics[scale=1]{images/expedia-10-1}
    \end{center}

\framebreak

A-priori approach: Lexicographic method

\begin{eqnarray*}
y_1^* &=& \min_{\conf \in \pcs} \cost_1(\conf)\\
y_2^* &=& \min_{\conf \in \{\conf ~|~ \cost_1(\conf) = y_1^*\}} \cost_2(\conf) \\
y_3^* &=& \min_{\conf \in \{\conf ~|~ \cost_1(\conf) = y_1^* \land \cost_2(\conf) = y_2^*\}} \cost_3(\conf) \\
&\vdots&
\end{eqnarray*}

But: different sequences provide different solutions.

\framebreak

\textbf{Summary a-priori approach:}
\begin{itemize}
\item In a single application, only one solution is obtained, which depends on the a-priori selection of weights, order, etc.
\item In case of repeated use, several solutions are obtained if weights, order, etc. are systematically varied.
\item Usually there are solutions that remain hidden from these methods.
\item Implicit assumption: single-criteria optimization is \enquote{simple}.
\end{itemize}

\end{frame}

\begin{frame}[allowframebreaks]{A-posteriori procedure}

A-posteriori methods, on the other hand, have the goal to

\begin{itemize}
\item find the set of \textbf{all} optimal solutions (the Pareto set),
\item select (if necessary) an optimal solution based on prior knowledge or individual preferences.
\end{itemize}

A-posteriori methods are therefore the more generic approach to solving a multi-criteria optimization problem.


\framebreak

\textbf{Example:} A user gets more detailed information about all Pareto optimal hotels (left) and chooses an optimal solution (right) based on previous knowledge or additional criteria (e.g. location of the hotel).

\vspace*{0.1cm}


\centering \includegraphics[scale=1]{images/expedia-11-1}


\end{frame}


\begin{frame}[allowframebreaks]{Evaluation of solutions}

A common metric for evaluating the performance of a set of solutions $\mathcal{P} \subset \pcs$ is the \textbf{dominated hypervolume}

$$
    S(\mathcal{P}, R) = \Lambda\left(\bigcup_{\tilde{\conf} in \mathcal{P}}\left\{\conf | \tilde{\conf} \prec \conf \prec R\right\}\right),
$$

where $\Lambda$ is the Lebuesge measure.
    \vspace{1cm}
    \begin{itemize}
            \item The dominated hypervolume is calculated respective to the reference point $R$, that can be chosen arbitrarely.
            \item Exact computation of the hypervolume is expensive (NP-hard), but fast approximations exist.
            \item The dominated hypervolume is also often called \textbf{S-Metric}.
    \end{itemize}

\framebreak

\begin{center}
\includegraphics[width = 0.3\linewidth]{images/dominated_hypervolume.png}
\end{center}

The dominated hypervolume of $\mathcal{P}$ (5 black points) is the area in the target function space (in respect to the reference point $R$) which is dominated by points $\mathcal{P}$.

\framebreak



\end{frame}

\end{document}
